#!@AWK@ -f

# LMDBG helper script
#
# Input:
#   malloc/realloc/free ...<SPACE>address1<SUBSEP>address2
# Output:
#   malloc/realloc/free ...
#    address1
#    address2

{
    stacktrace = 0

	if ($1 == "malloc" || $1 == "calloc")
		stacktrace = 1
	else if ($1 == "realloc")
		stacktrace = 1
	else if ($1 == "memalign" || $1 == "posix_memalign")
		stacktrace = 1
	else if ($1 == "free")
		stacktrace = 1
	else if ($1 == "stacktrace")
		stacktrace = 1
}

stacktrace {
	cnt = split($NF, arr, SUBSEP)

	$NF = ""
	print $0

	for (i=1; i <= cnt; ++i){
		gsub(/\033/, "\t", arr [i])
		print " " arr [i]
	}
	next
}

{
	print
}
